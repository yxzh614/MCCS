## 框架选择

本系统为Web单页应用，主要使用HTML、CSS、JavaScript语言进行编写，以MVVM框架基本结构进行搭建，使用Echarts插件完成图表展示功能。最终结果通过WebPack打包上传到服务器即可直接使用。

1 Web应用

  1. 基本原理
  
      Web应用存储在服务器，只需打开浏览器就可以直接使用。随着互联网的发展以及网络传输速度的不断提升，使用Web应用的代价不断降低，其相对于离线客户端的优势如下：

        * 跨平台
        * 实时更新代码
        * 云端数据存储

      Web应用存储在服务器上，用户通过在浏览器中输入特定域名访问服务器获取应用。域名存储在DNS服务器上，浏览器首先向DNS服务器请求域名对应的IP地址，然后向该IP发送TCP连接请求，成功建立TCP连接后发送HTTP请求，收到的文件就是应用主体，经过浏览器的HTML、CSS、JavaScript解析后就会在浏览器界面显示出来直接使用。

  2. 编程语言

      Web应用使用的基础编程语言为HTML、CSS、JavaScript。

      * HTML（超文本标记语言）是一种用来结构化Web网页及其内容的标记语言。对页面中不同的元素进行标记可以使其对CSS以及JavaScript是可读的，便于在代码中精确的控制元素的样式、内容等。HTML最新的标准为HTML5。

      * CSS（层叠样式表）是用来控制HTML元素样式的语言。CSS主要用来控制元素的盒模型、颜色、字体、位置、排列等等。CSS选择器是一种功能强大的HTML元素选择器，可以实现HTML元素的精确选择、类别选择、树型顺序选择等，还能通过伪类、伪元素来扩展选择器的功能。被选择的元素通过层叠的方式设置样式，不同的选择器有不同的优先级，根据优先级的先后决定使用哪个选择器。CSS支持绝对单位和相对单位。CSS可以通过媒体查询，相对百分比单位等方式实现对不同大小的屏幕进行适配。

      * JavaScript是一种脚本语言，运行于浏览器环境，负责本系统的逻辑控制。浏览器中可以运行的主流JavaScript实现是ECMAScript5，而其下一代ECMAScript6也已经逐渐被各大浏览器实现。相比较于Java、C#等静态类型语言，JavaScript作为一种动态语言有着更加灵活的特点。其开发效率高，体积更小，对于Web异步编程有着更成熟的实现，更加适合Web编程。随着V8引擎的出现，JavaScript后端也有一定的地位。由于其灵活快捷的特点JavaScript更适合编写一些服务器中间件。

      
  3. 使用框架

      本系统使用MVVM框架Vue进行编写。

      * MVVM模式指Model-View-ViewModel模式。其前身为MVC（Model-View-Controller）模式。MVC模式很好的分离了数据逻辑与视图逻辑的代码。当应用的体积不断增加时这一点尤其重要。在过去的网页应用例如php，逻辑代码与视图代码处于混合的状态。这种开发方式虽然快速、自由，但对于代码的维护、扩展带来了不必要的负担。MVC模式出现后改变了这一现状。将业务逻辑分离出来作为Model，将视图控制分离出来作为View，最后将通信代码抽象为Controller作为控制器。这种代码具有更好的可维护性、可读性和可扩展性。在Web应用中View复杂度提升，所以进一步抽象出了MVVM模式。为View专门创建了ViewModel来解决视图逻辑，弱化了Controller的作用并融合到VM中。

      * Vue是一套用于构建用户界面的渐进式框架。该框架结合MVVM模式，组件化分离等思想，帮助开发者自底向上逐层开发应用。Vue的核心代码主要负责视图层的搭建，简单易用而且可以轻松的与第三方库相结合。此外通过一些应用构建工具的帮助可以更轻松的开发单页应用。目前主流框架

      * ECharts是一个开源的可视化库，底层依赖轻量级的矢量图形库ZRender。ECharts提供了常规的折线图、柱状图、散点图、饼图、K线图等，更可以添加自定义图表。

## 接口设计实现

Web应用通过接口与服务器通信，对XXXXX进行控制。

* 登录：发送用户名与密码。返回登录状态以及session key用于识别用户。
* 注册：发送用户名与密码。返回注册结果并直接返回session key。
* 获取温室列表：发送session key，返回温室列表数组，其每一项保存温室的名称与id。
* 添加温室列表： 发送session key与温室id，返回操作结果。
* 编辑温室名称： 发送session key、温室id与新名称，返回操作结果。
* 删除温室： 发送session key与温室id，返回操作结果。
* 温室详情： 发送session key与温室id，返回温室相关的数据：
  |温度|湿度|水量|其他|
  |-|-|-|-|
  |设定温度|设定湿度|设定水量|温室编号
  |最高温度|最高湿度|已注水量|使用时间
  |平均温度|平均湿度|还需注水|主要功能
  |最低温度|最低湿度|水箱剩余|备注
* 更新温室信息：发送session key、温室id、编号、时间、功能、备注，返回操作结果。
* 获取实时温度数据：发送session key、温室id，返回当前最高温度、最低温度数据。
* 获取历史温度数据：发送session key、温室id、开始时间、结束时间，返回温度数据数组，其每一项包含时间以及最高温度、最低温度。
* 获取温度设定：发送session key、温室id，返回最高温度、最低温度、理想温度设定。
* 设置湿度：发送session key、温室id、最高湿度、最低湿度、理想湿度，返回操作结果。
* 获取实时湿度数据：发送session key、温室id，返回当前最高湿度、最低湿度数据。
* 获取历史湿度数据：发送session key、温室id、开始时间、结束时间，返回湿度数据数组，其每一项包含时间以及最高湿度、最低湿度。
* 获取湿度设定：发送session key、温室id，返回最高湿度、最低湿度、理想湿度设定。
* 设置湿度：发送session key、温室id、最高湿度、最低湿度、理想湿度，返回操作结果。
* 获取当前水量：发送session key、温室id，返回当前水量。
* 获取当前注水标量：发送session key、温室id，返回当前注水标量。
* 获取当前报警值：发送session key、温室id，返回当前报警值。
* 获取历史注水图：发送session key、温室id，返回历史注水图数组，其每一项包含是否注水、注水量以及时间。
* 更改注水信息：发送session key、温室id、注水量、超量预警、注水时间段数组，返回操作结果。
* 获取设备运行状态：发送session key、温室id，返回风机、水泵、喷雾和温度传感器的运行状态，分别为运行中、关机和故障。
asd | asd | asd

## 前端设计实现

组件化开发

通过将整个应用划分成不同组件，可以有效的提升开发的效率。对于应用中可以被独立出来的功能，都应该去设计成一个组件。组件的特点是高内聚、低耦合、可复用。一个组件应该隐藏自己内部的结构、样式以及逻辑代码，只通过外部接口传入和传出数据。避免因过多的修改不必要的代码而造成的结构混乱，使开发难度不断提升。一个组件也可以在多处复用，既能节约应用的体积也能方便开发者对代码进行统一的调整。

单向数据流

单向数据流是指数据只能从父组件流向子组件，而不能从子组件流向父组件。相对于数据可以在父子组件双向流动的双向数据流，单向的组件以一棵树呈现其结构，更便于对数据流进行管理。

Vue

Vue属于单向数据流的组件化开发库，满足这两点可以使Web开发的效率得到巨大的提升。Vue中子组件获取父组件数据通过数据绑定来实现，父组件只能通过监听子组件的事件来获取数据。

组件设计

通过对本系统的功能进行分析，设计出如下组件：

* 温室列表组件：带有温室列表显示、添加温室、编辑温室名称、删除温室功能。
* 分类按钮组件：显示分类图片、提供点击导航功能
* 折线图组件：根据数据显示折线图形，展示一段时间内的数据变化。
* 时间选择器组件：选择一段时间，用于向服务器请求这一段时间内的数据。

界面实现

根据UI设计图，使用以下的CSS和HTML完成静态界面的设计：

1. HTML

    * div 普通标签
    * p 段落标签
    * span 文字段标签
    * class属性 对元素进行分类，方便使用CSS进行样式设置
    * v-for属性 Vue的属性，用于列表渲染
    * v-if属性 Vue的属性，用于条件渲染
    * v-bind属性 Vue的属性，用于数据的单向绑定
    * v-model属性 Vue的属性，用于双向绑定
    * v-on属性 Vue的属性，用于时间监听

2. CSS

    * flex一维布局：可以方便快捷的设定一维方向上的布局，可以设定元素的大小、间距、基线拉伸样式等。
    * box-shadow：用于设置元素的边框阴影。
    * display：设置元素的显示方式，如block、inline、flex等。
    * color：设置元素文字的颜色。
    * background-color：设置元素的背景颜色。
    * box-sizing：设置元素的盒模型规则。
    * border：设置边框的宽度、样式、颜色。
    * margin：设置元素的外边距。
    * border-radious：设置元素边框的圆角样式。
    * float：设置元素浮动的样式。
    * line-height：设置元素的行高。
    * font-size：设置元素的字体大小。
    * text-align：设置元素垂直对齐的方式。

功能实现

1. 登陆模块

    成功后即可获取用户的session key，可以使用户后续不必登录直接使用功能。

1. 温室列表模块

    通过点击不同的温室名称向父组件发送自定义事件，父组件监听该事件并根据所点击的温室向其他组件发送数据。

    点击新建、编辑、删除按钮来控制列表中的内容并向服务器发送更新数据。

2. 分类列表按钮模块
    
    有温室总览、温度设定、湿度设定、注水设定、设备详情五种按钮，点击不同的按钮向父组件发送自定义事件，父组件监听该事件并根据所点击的分类改变主界面的内容。

3. 总览模块

    点击温室总览按钮跳转到该页面，向服务器请求当前温室的温度数据，湿度数据以及注水数据。每3秒执行一次查询同步服务器的数据。获取当前的温室信息并显示，点击修改可以修改温室信息，点击保存上传新的信息。

4. 温度设定模块

    从服务器获取当前温度在折线图上显示。根据输入的时间段显示一段时间内温度变化的折线图显示。获取当前温度数据并显示，对当前设定显示并更改，点击保存发送到服务器。

5. 湿度设定模块

    从服务器获取当前湿度在折线图上显示。根据输入的时间段显示一段时间内湿度变化的折线图显示。获取当前湿度数据并显示，对当前设定显示并更改，点击保存发送到服务器。

6. 注水设定模块

    从服务器获取当前注水量，注水标量以及设定的超量预警值显示在组件中，从服务器获取注水时间图并显示，设定注水量和预警值和注水时间段并发送到服务器。

7. 设备详情模块

    从服务器实时获取设备运行状态并显示在组件中，绿色代表正常运行，灰色代表关闭状态，红色代表设备发生故障。

代码发布

使用Vue-cli自带的WebPack打包，最后生成HTML、CSS、JavaScript以及静态资源的打包文件，放到服务器上即可访问。